TODO Обновить перед выпустом версии

## Трафарет

Заполняет шаблон текстового документа DOCX/ODT используя данные электронной таблицы XLS/XLSX/ODS. 

### Возможности

- Заполнение документов данными из табличного файла;
- В качестве документов-шаблонов используются файлы DOCX/ODT любого вида;
- В качестве файлов данных используются файлы XLS/XLSX/ODS;
- Самостоятельная настройка шаблона; 
- Выбор шаблона для заполнения;
- Выбор каталога для размещения итоговых документов;
- Выбор табличного листа с данными;
- Выбор номера для строки заголовка. 

### Справка по программе

Электронный документ-шаблон произвольного содержания, в файле DOCX или ODT, содержит маркеры, обозначающие места вставки значимых данных. В процессе обработки документа-шаблона происходит замещение маркера данными из табличного файла. 
Используется следущий формат для маркера: {Метка} - левая фигурная скобка, текстовая Метка, правая фигурная скобка.
В качестве Метки используется наименование столбца в табличном файле.

Например, для табличного файла, содержащего столбцы

```text
Фамилия     Имя     Отчество
Мухин       Юлий    Эльдарович
Богданова   Ванда   Митрофановна
```

в документе-шаблоне используются маркеры вида

```text
Уважаемый {Фамилия} {Имя} {Отчество}!
```

При обработке табличного документа учитывается, что первая по счету строка (Фамилия Имя Отчество) является строкой заголовка таблицы, а данные расположены ниже. Наименования столбцов в строке заголовка используются в качестве Меток при поиске маркеров в документе-шаблоне.

Таким образом, итоговый документ содержит текст (для первой строки данных)

```text
Уважаемый Мухин Юлий Эльдарович!
```

**Ограничения**
- В качестве докумена-шаблона допустимо использовать только файлы DOCX или ODT. Файлы DOC не поддерживаются.
- В табличном документе строка заголовка не должна содержать пустых ячеек.
- В табличном документе данные не должны содержать пустых строк. Обнаружим пустую строку алгоритм надстройки делает предположение, что обработаны все данные и завершает выполнение.

#### Пример использования

1. Зарегистрируйте надстройку "Трафарет". См. раздел "Установка".
2. Запустите приложение МойОфис Таблица, затем откройте документ samples/sample-data.xlsx.
3. В главном меню приложения выберите "Надстройки" - "Трафарет" - "Заполнить".
4. В выпадающем списке "Лист данных", выберите лист "Данные". 
5. В поле "Строка заголовка" укажите 1 (единица) в качестве номера строки заголовка. Номер строки заголовка соотвествует первой строке на табличном листе "Данные".
6. Нажмите кнопку "Выберите документ-шаблон", далее в диалоговом окне укажите файл template.docx в каталоге samples. Нажмите кнопку "Открыть".
7. Нажмите кнопку "Выберите папку для для сохранения документов", далее в диалоговом окне выберите папку samples. Нажмите кнопку "Выбрать".
8. Нажмите кнопку "Сформировать документы".
9. Перейдите в папку samples, где находятся итоговые документы "Богданова.docx", "Волков.docx" и т.д.

### Установка

Файл надстройки: trafaret.mox.

- Надстройка предназначена для использования в приложении МойОфис Таблица.

1. Запустите приложение МойОфис Таблица.
2. В главном меню выберите "Надстройки" - "Управление надстройками".
3. Находясь в диалоговом окне "Управление надстройками" нажмите кнопку "Установить надстройку" (либо кнопку "Установить", если никакие надстройки не были установлены ранее), далее выберите файл trafaret.mox и нажмите кнопку "Открыть". 
4. Информационное сообщение "Разработчик не может быть проверен" отображается поскольку надстройка "Трафарет" распространяется в виде неподписанного файла trafaret.mox. Нажмите кнопку "Продолжать". Для дополнительной информации см. раздел "Сборка и подписание надстройки".
5. Ознакомьтесь с текстом лицензионного соглашения. Нажмите кнопку "Принять", если вы согласны с условиями лицензионного соглашения, в этом случае регистрация надстройки завершится и надстройка будет установлена в приложении. Нажмите кнопку "Отказаться", если вы не согласны с условиями лицензионного соглашения, в этом случае регистрация надстройки будет прервана.
6. Закройте диалоговое окно "Управление надстройками".
7. Установка надстройка Трафарет завершена.
8. Для использования надстрйоки в главном меню выберите "Надстройки" - "Трафарет" - "Заполнить".

### Сборка и подписание надстройки

Надстройка "Трафарет" распространяется:
- В виде двоичного файла trafaret.mox;
- В исходных кодах на языке программирования Lua.

Надстройка в виде двоичного файла trafaret.mox готова к использованию, однако не подписана электронным ключем разработчика. Приложение МойОфис Таблица отображает информационное сообщение "Разработчик не может быть проверен" во время регистрации надстройки. 

Для самостоятельной сборки надстройки из исходного кода используйте утилиту mox, в версии для Linux, либо mox.exe, в версии для Microsoft Windows.

Расположение утилиты mox
- В случае использования ОС на базе Linux, включая отечественные ОС, в каталоге `/opt/myoffice-standard/`, файл под названием `mox`;
- В случае использования ОС Microsoft Windows, в каталоге `C:\Program Files\MyOffice`, файл под названием `mox.exe`.

Исходный код надстройки располагается в каталоге `src`, результат сборки помещается в каталог `bin`.

Вызов утилиты `mox` для сбоки надстройки имеет вид

```bash
mox create --delete --source=./src --package=./bin/trafaret.mox
```

Назначение ключей:
- ключ `create` используется для создания двоичного файла надстройки .mox из исходного кода на языке Lua;
- ключ `delete` используется для удаления предыдущей сборки **в каталоге `bin`**, перед созданием новой сборки;
- ключ `source` используется для указания местоположения исходного кода надстройки на языке Lua;
- ключ `package` используется для указания местоположения двоичного файла надстройки .mox.

См. также документ "Руководство программиста. Модули надстроек редакторов МойОфис", раздел 2.3 "Подпись надстройки", подраздел "Создание надстройки".

Для подписания надстройки используется утилита `mox` с ключем `sign`. Вызов утилиты имеет вид

```bash
mox sign --package=./bin/trafaret.mox --certificate=./bin/<файл_сертификата> --private-key=./bin/<файл_ключа> --passphrase=<пароль>
```

Назначение ключей:
- ключ sign используется для подписания двоичного файла надстройки .mox ключем разработчика;
- ключ package используется для указания местоположения двоичного файла надстройки .mox;
- ключ certificate используется для указания местоположения файла сертификата .crt;
- ключ private-key используется для указания местоположения файла закрытого ключа .pem;
- ключ password используется для указания пароля для ключа разработчика, строковое значение в кавычках, например, "1234".

См. также документ "Руководство программиста. Модули надстроек редакторов МойОфис", раздел 2.3 "Подпись надстройки", подраздел "Подпись надстройки".

